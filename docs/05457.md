# 令人惊叹的可弯曲物体的运动捕捉

> 原文:[https://hack aday . com/2017/06/22/amazing-motion-capture-of-bendy-things/](https://hackaday.com/2017/06/22/amazing-motion-capture-of-bendy-things/)

亲爱的读者，你曾经需要在 3D 中实时绘制游泳池面条的位置吗？你当然有，今天，你很幸运！我整理了一个解决方案，一定会让你快速解决这个“你从来不知道的问题”

好吧，这背后有点故事。回到我美好的大学时代，我有机会玩水下机器人。我记得自己摸索着想:“嗯，有了这个机器人系绳，沿着系绳的长度串一组惯性测量单元来估计机器人在三维空间中的位置不是很好吗？”几年后，本着解决那个问题的精神，我一起做了这个 IMU Noodle 项目来玩一些真正的硬件。通过一点四元数数学，一个漂亮的 IMU 和一些定制的 PCBAs，这个想法已经从一些闲置的大脑漫游变成了一个真正的设备。这是一个非常有趣的例子，利用现有的硬件和一点小聪明来构建一个独特而可靠的系统。

至于为什么？早在 2012 年，我第一次看到 IMU 面条出现在这些页面上，我很困惑。我刚刚*有*造一个！现在完成了，我认为有足够的数学和有趣的电子金块值得一篇完整的文章来写这个月的业余冒险。亲爱的读者，让我告诉你一个美妙的故事，数学遇到电子，鼓起勇气约它出去吃早午餐。

## 到底什么是 IMU 面条？

IMU Noodle 诞生于商品化的 MEMs 传感器世界，是现代运动捕捉技术的鼻祖。简而言之，它是在一个灵活的对象上串在一起的 IMU 的集合，以在 3D 中模拟该对象的曲率。链中的每个 IMU 都是可单独寻址的，并以*四元数*的形式报告其在三维空间中的方向。IMU 数据通过一个 Teensy 以一个健康的 60Hz 剪辑流回我的电脑，其中一小段 [OpenFrameworks](http://openframeworks.cc/) 支持的代码将数据可视化。

## 面条五金

我们在这些页面上读到的很多东西都因“聪明”而得到支持不过今天，我想展示一个与众不同的设计:在一切都很简单的地方。虽然许多硬件项目都有过多的核心特性，但这个项目只有一个，而且是一遍又一遍复制的。再说硬件。

### IMU 面条节点:

在硬件方面，IMU 节点并不复杂。这或多或少只是博世 BNO055 方向传感器的分线板，有两个额外的技巧。首先，这些板通过*差分* (D)I C 总线进行通信。我们可能很喜欢 I C。差分部分只是将 SDA 和 SCL 信号重新编码到两个不同的对上，让我们[通过长电缆](http://hackaday.com/2017/03/31/an-introduction-to-differential-i%C2%B2c/)扩展 I C 总线。

如果你对为什么不能让 SDA 和 SCL 线更长感到好奇，看看几个月前我的大脑漫游。

![](../Images/b3f3dba9e0712735249f2920008bdf21.png)

US Currency Nugget for scale

接下来，这些节点将沿着一条电缆共享一条 I C 总线，所以它们每个都需要一个唯一的地址。为了实现这一点，我使用了 LTC 4316 IC babel fish 来重新编码 BNO 的地址。为了设置新地址，我使用了一个分压器(3 个电阻)，其电压对应于 LTC4316 [数据表](http://cds.linear.com/docs/en/datasheet/4316fa.pdf)中的一个位代码。(计算变得有点混乱，所以我写了一个 IPython 笔记本来完成繁重的工作。)

通过这两项调整，我现在可以将一条长带状电缆延长几米，并在同一条电缆上的任何位置放置多达 63 个 IMU。它干净，简单，我唯一的工作是焊接 3 个独特的电阻来设置地址。(注意:在这些印刷电路板的下面贴上地址标签非常方便。)

### 万能的 BNO055

BNO055 本身确实是一块非凡的硅片。它不仅有一个三轴陀螺仪、加速度计和磁力计，还有一个内部微控制器，可以对这些传感器进行采样，并运行 IMU“融合”算法来估计方向。

传感器融合*使用*是一个计算量大且技术上具有挑战性的问题，涉及卡尔曼滤波器和良好表征的传感器。然而，早在 2010 年，一位名叫[Sebastian Madgwick]的博士生发表了一篇论文，介绍了一种计算成本低廉的算法，该算法可以在低至 10Hz 的采样频率下工作，并且比一些带有源代码的专有替代方案[PDF](https://www.samba.org/tridge/UAV/madgwick_internal_report.pdf)更好地*工作*!].通过查阅文献，这种算法非常受欢迎(并且在资源受限的设备上运行得非常好)，我大胆猜测 BNO055 从[Madgwick]的工作中获得了一些灵感。

就 IMU 节点硬件而言，就是这样！几年前，这个项目可能需要无数个小时的融合算法设计和传感器调整，但 BNO055 已经友好地将这项工作卸载到一块 10 美元的硅片上。

## 面条数学

现在来做些数学。别担心这个。如果你能概念化向量，你会做得很好。

### 现实世界的假设:

为了令人信服地将我们现实生活中的面条复制成一个虚拟的二重身，我们需要制定法律。这些规则是“赠品”，可以帮助我们设计出最接近我们现实生活约束的解决方案。

![](../Images/58af872ca2e1b71e6499317a727cf21d.png)

首先，我们假设节点之间的距离是固定的。我们把我们的节点记录下来，所以这个假设在现实生活中也应该相当接近**。接下来，我们将声明起始节点的*位置*也是固定的。因此，我们的面条可以卷曲和扭曲，但它不能平移。最后，我们将声明两个节点之间的形状是一个平滑的圆弧。对于最后一个假设，请注意，更多的节点意味着形状的更好的近似，但是我发现 3 个节点已经足够欺骗我们大多数人了。

有了这些规则，我们就可以开始画画了。

* *实际上，当节点*固定在我们的柔性物体的外表面上时，它们之间的距离*不会改变。一个更好的近似方法是将 IMU 安装在我们柔性物体的*中心*，尽管有弯曲运动，但实际上*的*长度保持不变。

### 旋转四元数的 Noob 指南:

好了，现在是大问题。BNO055 输出编码为*单位四元数*的方向。在四维空间中什么是*单位四元数*？四元数是 4 个数字的集合，1 个实数，3 个虚数。我们可以将它们表示为一个由四个分量组成的元组:( *w，x，y，z)* 。一个单位四元数的*范数*(想想大小)为 1。如今，单位四元数具有非常方便的数学属性，这使得它们非常适合在 3D 中表示旋转。(旁白:一个*方向*只是一个有起点的旋转。)四元数对于如何将它们相加和相乘也有非常明确的规则。

好，那么四个数字是如何帮助我们表示旋转的呢？原来，我们可以在一个单位四元数内编码两条信息:一个轴(表示为 3D 向量)和一个角度(只是一个标量)。

在人们一致认为四元数更好之前，我们曾经用绕 3D 平面轴的 3 次旋转来表示 3D 方向，通常称为*滚动*、*俯仰、*和*偏航*。这种表示有各种各样的复杂性。首先，旋转的顺序很重要。这意味着选择滚转-俯仰-偏航，或者说，俯仰-滚转-偏航，将会使我们处于两种不同的最终方向！下一个问题是一种叫做*万向节锁*的现象。简而言之，如果在我们的旋转序列中，我们将*旋转到另一个旋转轴*上，使得它们都对齐，我们就失去了一个自由度。(为了更好的解释，请查看这个剪辑。)万向锁也阻止我们能够从一个方位到另一个方位采取直接路径。

四元数拯救世界！四元数只使用一次旋转，而不是将一个方向编码为从起始方向开始的三次独立旋转。这样做依赖于欧拉旋转定理，在我们的例子中，该定理指出，围绕原点的 3D 平面的三个轴的任何三次旋转都可以通过围绕穿过同一原点的某个轴的一次旋转来概括。因此，我们不需要保存关于三个独立旋转的信息，我们只需要保存一个，这正是四元数所做的。

请记住，虽然四元数*通过存储轴和角度来编码*旋转，但我们实际上并不绘制这个轴或角度。相反，我们使用四元数作为*操作符*。由于四元数与 3D 向量相乘有非常明确的规则，我们通常从一个向量开始，用这个向量和四元数计算两个四元数乘积，并得到一个向量，这是将向量旋转四元数中存储的轴和角度量的结果。

### SLERP 算法:

对于这个项目来说，四元数最有用的特性可能是它们能够提供干净的插值。插值听起来很复杂，但这个想法很简单。假设我们有两个方向:开始方向(A)和结束方向(B)。我们希望沿着最短的路径从起始方向平滑地旋转到结束方向，这将是一个平滑的弧线。更重要的是，我们希望从开始到结束的过程中采取均匀间隔的步骤。

![](../Images/4d7fbb03dd1a72d5de9f2a67089a4af0.png)

球形线性插值算法(SLERP)就是这样做的，它采用两个四元数来表示我们的开始和结束方向，并采用一个标量(从 0 到 1)来确定我们想要在路径上结束多远。虽然这个想法看起来很简单，但事实证明，编写一个等价的算法对旋转矩阵做同样的事情是非常困难的。当我们的方向被编码为旋转矩阵时，没有一个干净的方法可以平滑地从一个方向插值到另一个方向。如果我们的项目需要平滑插值，我们最好的选择是使用四元数。

如果我们刚刚开始使用四元数，这里显示的图表可能会有些误导，所以这里有一个快速提醒。不要忘了我们使用类似*运算符*的四元数。当我们使用单位四元数来存储旋转信息时，我们像使用函数一样使用它们。我们的输入是一个向量。然后我们计算几个四元数乘积。最后，我们的输出是一个向量。因此，这张图实际上没有显示任何四元数！更确切地说，它显示了两个向量已经旋转到由四元数 *A* 和 *B* 编码的方向。

### 面条涂鸦算法:

给定我们的初始假设和一个在方向之间平滑插值的好方法，我们完全可以在 3D 中绘制我们的面条。算法是这样的:

假设一个线段被定义为相邻节点之间的长度部分。首先，将段长度划分成一定数量的子段。

![](../Images/b103b6061e7f4835c9ba2f80f9a53511.png)

从起始方向开始，对于每对相邻的方向，将子段长度的向量转换到前一个向量的头部(使用向量加法)，通过使用 SLERP 计算的总旋转的当前部分旋转该向量，然后绘制该向量。

简而言之，我们从一个四元数到下一个四元数绘制的子线段越多，我们的可视化就越有说服力。

## Demo Reel

上述算法以 60Hz 的限幅运行；当我们看到运动中的结果时，看起来有趣多了。

 [https://www.youtube.com/embed/dD4OspnR3uA?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent](https://www.youtube.com/embed/dD4OspnR3uA?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&wmode=transparent)

T2】

## 商品化 MEMs 传感器世界的魔力:

这些天来，我们的手机挤满了重型嵌入式传感器，以了解我们的环境。像压力、温度、方向和全球位置这样的条件都在我们的指尖；有时候我们很容易忘记我们的口袋里有多少关于我们世界的信息。应用程序开发人员喜欢这些第六感在我们的世界中重现。见鬼，想象一下没有 GPS 的拼车技术或者没有车载摄像头的视频通话。

虽然应用程序作者和消费者正在收获手机连接感应的好处，但仍有丰富的未知领域，只需在手机之外玩传感器本身。这就是你进来的地方！亲爱的读者，我对你的挑战是绘制这片未被探索的领域。深入挖掘，探索它的极限！当然，如果你发现了什么有趣的东西，请告诉我们。

最后，如果你喜欢你在这里看到的，为什么不试着建一个呢？PCB 文件、可视化代码和固件都可以在 Github 上下载。
# 传感器网络让稻农生活更轻松

> 原文:[https://hack aday . com/2015/10/05/sensor-net-makes-life-eastern-for-rice-farmers/](https://hackaday.com/2015/10/05/sensor-net-makes-life-easier-for-rice-farmers/)

水稻在世界各地被种植在被称为稻田的田地中，它是种植中最需要养护的农作物之一。稻田本身就需要大量的维护。它充满了水，必须保持在一个恒定的水平，略低于阻止水稻幼苗生长的高度，但又足以淹没任何与水稻秸秆争夺养分的杂草。这种技术被称为持续洪水，稻农的一大部分工作是每天检查稻田，以确保水位正常，没有可能导致漏水的裂缝或漏洞。

这个过程是劳动密集型的，使用的技术几个世纪以来都没有太大变化。我所在地区的大部分稻农都是 65-70 岁左右的老人。对于这些努力工作的人来说，一点点技术可以让他们的生活发生很大的变化。这是 TechRice 背后的想法。

TechRice 是一个由日本的[黑客农场](http://www.hackerfarm.jp)和[数字车库](http://www.garage.co.jp/en)合作的项目。“未来实验室”( FutureLab)是 Digital Garage 内部的一个研发小组，其中一位负责人联系了我，他们问我一些可能涉及物联网的有趣项目。我并不特别喜欢“物联网”这个术语，但有许多涉及传感器网络的项目可以完成，这对日本和世界各地都很有用。

我们在 Ebisu 的总部会见了 Digital Garage，讨论了一些可能的项目。我最后还谈到了 hackerfarm，这是我和一些朋友在日本农村建立的黑客空间，专注于农业技术和影响日本农村的问题。其中一个项目是使用无线传感器网络进行稻田监测，这引起了 FutureLab 一些成员的注意。TechRice 项目就是这样开始的。

### 稻田传感器网络很有意义

[![SONY DSC](../Images/c24e4888cfcea05a9335b0af887d1f15.png)T2】](https://hackaday.com/wp-content/uploads/2015/09/techrice_01.jpg)

hackerfarm 周围的地区是一个丘陵水稻种植社区，有许多阶梯状的水稻梯田。由于地形的原因，稻田不能长到超过几平方米，大约足够一个家庭吃一年。一平方公里内可能有多达 30 个稻田，每个属于拥有和经营它们的不同家庭。

稻田不靠近农民的家，所以农民必须每天走到稻田的入口处，走上山去检查稻田。如果有任何问题，他们也需要对它进行维护。随着农民年龄的增长，每天去稻田和上山去他们的稻田变得更加困难。当我在当地社区讨论各种问题时，我发现这个问题可以通过一点技术自动化来解决。要做到这一点，最简单的是一个水位传感器，一种将水位测量结果传递给服务器的方法，以及一种可视化数据的方法。

### 一块简单的板就能完成所有工作

[![TechRice_07](../Images/4d155c803417f760b217dba098059130.png)](https://hackaday.com/wp-content/uploads/2015/09/techrice_07.jpg) 主传感器节点使用了一种叫做“Saboten”的设备，在日语中的意思是“仙人掌”。这是我最初设计的一个装置，用于监测喜马拉雅山大型储水罐的水位，也用于监测哥斯达黎加的红树林。它由基于 ATMega1284P 微控制器的改进型 Arduino 平台组成。我选择这个 MCU 是因为它有 16kB 的 SRAM，而不是标准 Arduino MCUs 中使用的 2kB。由于我们使用 FAT32 文件系统在 SD 卡上本地存储数据，并组装长文本字符串发送到聚合器，因此 RAM 的速度非常快。SD 卡用作传感器数据的本地备份，并维护系统日志，以便在系统出现问题时进行调试和分析。我也想继续使用 Arduino 环境，因为它被一个伟大的开发者社区广泛使用。

### 感应室外稻田的水位

主传感器是一个被 MaxBotix 称为 MaxSonar 的[超声波声学测距传感器。声学传感器通常用于非接触式液位感测，因为它们没有浮子或浸没式传感器经常遇到的缺点，也不会有化学物质渗入水中的风险。MaxSonar 本质上是一个放大的声学扬声器，带有一个喇叭，用于将超声波啁啾声聚焦在一个方向上。我们还在尝试使用防水压电致动器和 3d 打印喇叭来构建我们自己的超声波水平传感器，看看我们可以获得什么样的范围。对于稻田监测，我们只需要大约两米的范围，所以周围的任何东西都可以。最大声纳的作用距离大约为 10 米，对于这种特殊的应用来说，这个距离太大了。](http://www.maxbotix.com/Ultrasonic_Sensors/High_Accuracy_Sensors.htm)

前端 RF 接口包括一个 900 MHz 802.15.4 无线收发器，发射器上有一个 500 mW 功率放大器，接收器上有一个 8 dB 低噪声放大器。实现这些是为了优化传输范围，因为许多应用的节点相隔几公里。使用合适的天线，可以将数据发送到 10 公里以外，因此对于直径约为 2 公里的水稻梯田来说，这是大材小用。

我还在 Saboten 上安装了一个温度补偿实时时钟，为周期性的睡眠唤醒提供准确的警报。在低功耗睡眠模式下，MCU 只能从几个来源被唤醒，其中之一是其 IRQ 线路上的中断。实时时钟可以编程为每毫秒、每秒、每小时、每天、每周等触发一次中断的警报。对于低功耗应用来说，这是一个很有价值的特性，因为 AVR 上唯一内置的定时唤醒方式是使用最大超时为 8 秒的看门狗定时器。如果我们想要 4 个小时的睡眠间隔，这将导致大量的能量浪费。

RTC 芯片还具有温度补偿功能，可随着温度变化降低时钟漂移量。这是设计部署在室外且需要保持精确时间的设备时要考虑的一个重要因素。对于传感器网络来说，精确的计时至关重要，因为我们需要对齐每个节点的数据，而数据对齐通常是通过时间戳来完成的。

### 啜饮电池，利用阳光

开发无线传感器节点时要考虑的最大问题之一是功耗。许多人试图开发一种具有绝对最低功耗的设计，但这通常需要权衡和扭曲才能将功耗降至最低。Saboten 设备在低功率模式下降至约 300 uA，这足以在标准 2000 mAh LiPo 电池下生存约 9 个月。本来可以针对更低的功耗进行优化，但这需要使用昂贵的部件，增加软件的复杂性，从而可能增加现场故障的几率。相反，Saboten 有一个内置的太阳能充电控制器，配备了 100 毫安，5V 的太阳能电池板。这是一块相当标准的太阳能电池板，在深圳市场上不到一美元就能买到。在 1mA(活动+睡眠)的平均电流消耗下，在阳光下用面板充电一小时将保持系统运行大约 4 天。换句话说，即使几个月没有太阳，也有足够的电量让电池充满电。

我还添加了一些小功能来帮助分析和系统调试，尤其是远程调试。电池电压和太阳能电压上有一个电压监控器。有了这两条信息，就有可能远程查看太阳能电池板是否正在为系统正确充电，电池是否正在变坏，或者系统是否没有按照预期休眠。我喜欢将电力系统数据与传感器数据一起发送，这样我们就可以预测某个节点何时会出现故障，还可以查看是否有任何与“奇怪”数据相关的电力异常。我还将 Saboten 板安装到 IP65 防风雨外壳上，所有外部电缆都连接到电缆密封套，以保持防风雨密封的完整性。

Saboten 传感器节点将所有数据发送到一个边缘路由器，这基本上是一个安装了 3G 屏蔽的 Saboten。3G 调制解调器通常是关闭的，每天只打开两次来上传数据。它是一个巨大的功耗，当它刚刚打开并搜索基站时，最大电流消耗为 5V(10W)2A。我们目前非常小心那块板上的功耗，但希望能更频繁地上传，因为我们为它正确地确定了太阳能电池板和电池的大小。

### 固件、REST 和 Python

该固件基本上是通过 chibiArduino 库实现电源管理和通信的普通固件。你可以通过查看几年前我为 Freakduino 发表的教程来了解电源管理和通信代码是如何编写的。基本的硬件子系统和我的 Freakduino 板是一样的，所以这个项目中的大部分代码都是循环使用的。但是[完整的设备代码](https://github.com/DgFutureLab/satoyama-node)存放在数字车库 Futurelab GitHub 账户上。

在我看来，该软件更有趣的部分是 web 后端。这一部分是由 Digital Garage 的 Halfdan Rump 完成的，它向我介绍了 Python 作为 web 编程工具的奇妙之处。我们使用了 [Python Flask](http://flask.pocoo.org) ，这使得创建 RESTful API 变得非常简单。Flask 框架还包含数据库插件来处理最流行的数据库，所以接口也很简单。

Halfdan 编写的 TechRice API 被称为 Satoyama API，以 RESTful 方式处理标准的 CRUD 操作。数据通过上传到 Heroku 服务器上的 JSON 消息交换，服务器上有一个 Postgre 数据库。数据由每个传感器叶节点收集，并发送到聚合器节点，聚合器节点是带有 3G 调制解调器的边缘路由器。3G 调制解调器每天启动两次，通过 HTTP 将数据上传到 Satoyama 服务器，服务器将更新数据库条目。一旦数据进入数据库，数据就可以被移动应用程序使用或显示在网页上。

只是一句警告。代码和硬件仍然是一个进行中的工作，所以它经常变化，一直在上升和下降。

### 网络拓扑

网络拓扑对于参与传感器网络的人们来说是一个有趣的话题。我最初是网状网络的粉丝，但是自从我已经有了一些实际的部署，我开始更喜欢单跳网络。在这种情况下，我使用 chibiArduino 无线栈来实现到聚合器节点的单跳链接。有了放大的射频前端，在主要是开阔的场地，范围在 1.5 公里左右没有问题。总的来说，我更喜欢尽可能使用单跳链路，而不是改变发射功率和天线增益。保持网络简单意味着网络瘫痪的可能性更小，这也意味着我不必经常去现场排除网络故障。

### 文本字段测试和文本调试

 [![TechRice_05](../Images/7f3173e5b389548968202a77035c397f.png "TechRice_05")](https://hackaday.com/2015/10/05/sensor-net-makes-life-easier-for-rice-farmers/techrice_05/)  [![TechRice_02](../Images/c938c43117db2062e5f17e8b395d06b1.png "TechRice_02")](https://hackaday.com/2015/10/05/sensor-net-makes-life-easier-for-rice-farmers/techrice_02/) 

该项目是在今年水稻种植季节部署的，我们收集了成功的初始数据，但也指出了我们逻辑中的一些漏洞。在电源管理方面有一些不正确的假设，我们主要需要使系统更加健壮。在外面的稻田里，有各种各样的昆虫会愉快地爬进任何可用的洞或缝隙，包括声音传感器的喇叭。这就是我们正在试验创造我们自己的传感器的一个原因，这种传感器也可以防虫。否则，这主要是一个改进硬件、软件、修复缺陷和使系统足够健壮的迭代过程，以便它可以部署在更远的位置并具有高正常运行时间。

### 从监测稻田到追踪野猪

我们希望该系统在明年的水稻种植中完全在线，并将其扩展到其他应用，如野猪陷阱监测。野猪在日本是一种入侵物种，被认为是一种巨大的害虫，因为它们可以在一夜之间毁灭一个农场。野猪陷阱设置在该地区周围，但许多猎人年纪较大，不能一直管理陷阱。我们将修改该系统，以便在抓到野猪时通知陷阱所有者。

我们还与菲律宾巴兰加市的一个名为 TechAguru 的组织合作。TechAguru 是菲律宾农村 Balanga makerspace 的一个分支，他们的重点是优化那里的水稻种植过程。TechAguru 的创始人之一 John Auxilios 今年来到 hackerfarm 讨论他们的项目，我们计划将该系统带到那里，并与他们在菲律宾的水稻种植方面进行合作。除此之外，我们主要希望让系统为黄金时间做好准备，并尽快进行开源发布:)

### TechRice 团队

![TechRice_06](../Images/35d0b951387b100b4d3db746c6dff1dc.png)

TechRice 的主要团队由一名硬件工程师(Akiba)、一名固件/嵌入式工程师
(Masa)、一名前端/后端 web 程序员(Halfdan)、一名移动/数据可视化程序员(森英士)以及其他协助完成与项目相关的各种任务的工程师组成。该项目的复杂性之一是无线传感器网络部署需要来自多个领域的专家。需要大量专用硬件来满足电源和通信要求，需要固件来运行各个节点，需要 web 后端编程来实现 web 服务和 REST API，还需要前端数据可视化来实现 web 和移动演示。我认为我们非常幸运，我们有实施这样一个项目所需的所有经验。
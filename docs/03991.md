# 隐藏在 ESP32 芯片中的基本解释器

> 原文:[https://hack aday . com/2016/10/27/basic-interpreter-hidden-in-esp32-silicon/](https://hackaday.com/2016/10/27/basic-interpreter-hidden-in-esp32-silicon/)

我们一直在跟上为 ESP32 WiFi 芯片开发的软件，这意味着大量的闪烁，连接随机的电线，并重新启动。一路上，我们偶然发现了一个复活节彩蛋:ESP32 处理器有一个内置的 BASIC 解释器可以依靠。

这是一个很酷的小技巧，但我们无法找到一些重要的功能，使它变得更加有用。不过，用芯片实时玩耍还是很有趣的。在 ESP32 BASIC 中，LED 闪烁的速度绝对比在 Arduino 上快！

## 入门基础

[![](../Images/8dd0c069232dd8fbf5ea3c8acfa8e0f6.png)T2】](https://asciinema.org/a/3ek0x0yb6p5e837qwtiyohq1i)

起初，我们认为进入基本外壳的关键是简单地阻塞板载闪存程序 ROM，因为我们是通过连接到 GPIO 12 发现它的，GPIO 12 被标记为“HSPI”的 MOSI 引脚。但是，使用“范围和连续性测试仪”进行一点验证，验证启动时没有数据通过此引脚，flash 的 SPI 线甚至没有从模块中断开。看起来好像 ESP32 的任何引导都是在测试 GPIO 12 上的高电压。不要问我们。

总之，故事的简短版本是:将 GPIO 12 拉高，然后点击 reset。通过串行连接到 ESP32，并按 enter 键以停止它不断重新启动。`Falling back to built-in command interpreter.` Woot。设置你的终端程序在每一行的末尾只发送一个换行符就可以了！手头没有 ESP32 来试试这个？我录制了我的冒险旅程的视频，所以至少你可以和我一起去。

## LED 闪烁，基本样式

面对命令提示符时，您会做的第一件事是什么？输入“帮助”，对吗？嗯，那很有效。ESP32 配备了“一个非常基本的 ROM 控制台。可用的命令/功能:“然后列出您需要开始的一切。现在，我们的 BASIC 有点生疏了，可以追溯到 Tandy Color Computer 时代，但我们很快就做了一些演示，坦率地说，我们玩得很开心。

>关于
ESP32 from Basic(c)2016 Espressif Shanghai
源自迈克·菲尔德和斯科特·劳伦斯的 TinyBasic Plus

Espressif 很好地向 BASIC 中添加了`iodir`和`ioset`命令，它们允许您设置任何引脚(输入或输出)的数据方向，并对其进行读取或写入。这意味着闪烁的 led 就在几个字之外。

>列表

5 IODIR 32，1
10 FOR I = 1 到 10
20 打印“Hello Hackaday！”
30 GOSUB 100
40 下一个 I
50 结束
100 雷姆眨眼子程序
110 IOSET 32，1
120 延时 200
130 IOSET 32，0
140 延时 100
150 返回
OK

> run
Hello Hackaday！
…

有循环和闪烁。比 Arduino 入门还简单！

## 神秘和失踪

但我们也就到此为止了。有一个`print`命令和一个`input`命令，但是我们不知道如何处理字符串，所以我们从来没有得到进一步超过

10 打印“输入你喜欢的数字”
20 输入 F
30 如果 F = 42 转到 100
40 打印“真的吗？我更喜欢“
50 PRINT F+1
60 END
100 PRINT”这也是我最喜欢的数字
110 结束

有一个`rseed`命令，帮助中列出了一个`rnd`，但是当我们试图在函数中使用它时，它看起来像是一个语法错误。`ioget`，应该读取引脚上的逻辑电压，似乎也不工作。顺着列表往下看，我们沮丧地发现，许多我们想教小孩子编程的功能都不存在。

## 基本不用偷看和戳？

我们无法让`peek`和`poke`为我们的生活工作。看来它们没有被实现，这很遗憾，因为这两个命令实际上是 BASIC 实时探索新芯片内部的最佳特性。虽然你并不经常有理由去摆弄你的台式计算机内部的单个位，但是当处理带有存储器映射硬件外设的微控制器时，交互地翻转这些小硅开关是一个极好的工具。

`Peek`和`poke`是 BASIC 存在的理由。没有它们，它只是一种玩具语言。

后期编辑:[Sprite_tm]在基础上写的。我全错了。偷看戳工作！只是语法没猜对。的确，[Sprite_tm]证实他们在最初的芯片检验阶段确实使用了它们。多酷啊。

以下代码启用 GPIO 4 作为输出，打开然后再次关闭，然后以十六进制打印出 GPIO 4 输入的值。我们在另一个 GPIO 上切换输入电压，并观察位的浮动。剩下的就是简单的软件问题了。

5 戳&H3FF44020，16
10 戳& H3FF44004，16
20 延时 200
20 戳& H3FF44004，0
30 延时 200
40 PHEX PEEK(&h3ff 4403 c)
50 GOTO 10

要了解这些数字的含义，请参见[技术文档](https://espressif.com/sites/default/files/documentation/esp32_technical_reference_manual_en.pdf) (PDF)中的内存图。玩得开心！

## 这些不是机器人…

无论如何，好消息是 Espressif 团队已经完成了 Arduino 核心的大部分工作，我们很快会有一个完整的评测。他们还在继续疯狂地开发 C 库，真正的程序员将使用这些库来运行这些芯片，所以对他们来说，在复活节彩蛋中实现`peek`可能不是首要任务。但我们度过了一个愉快的下午，学习基本技能。
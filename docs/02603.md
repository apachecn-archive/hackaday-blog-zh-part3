# 数据记录；大家都在做，你为什么不做？

> 原文：<https://hackaday.com/2016/06/09/data-logging-everyones-doing-it-why-arent-you/>

在特斯拉汽车公司(Tesla Motors)的汽车和 SpaceX 的火箭之间，埃隆·马斯克(Elon Musk)的工程师必须做对一些事情。在某种程度上，SpaceX 成功着陆他们的第一级火箭是由于对遥测数据的分析。你可以在直播视频中看到一些他们的运载火箭的数据，当然还有很多没有展示出来。

《麻省理工科技评论》 中的一篇[文章通过分析来自他们汽车的遥测数据，提供了特斯拉如何在自动驾驶汽车运营中后来居上的类似见解。自 2014 年以来，他们的 Model S 接收了越来越多的传感器，这些传感器都通过车辆的始终在线蜂窝信道报告数据。特斯拉的 Sterling Anderson 报告说，他们每 10 小时就能获得 100 万英里的数据。](https://www.technologyreview.com/s/601582/teslas-first-autonomous-vehicle-may-arrive-before-the-model-3/)

![Image Credit Tesla](img/e65afbb31e5f9385b6aec33bfe6e0380.png)

Image Credit Tesla

同样的方法可以帮助我们改进我们的系统，但许多人认为创建关键数据的日志在时间和资源上是昂贵的。如果你的系统很完善(哈哈！)这将是一个有效的评估。如果分析解释了为什么你的无人机或机器人想要向左进入建筑物而不是向右进入空旷地带，那么这些数据往往变得无价。

我已经在我的专业和业余项目中使用了日志。一个系统使用卫星通信从远程管道位置获取数据。两个值得注意的地点是内华达州的一座山的侧面，那里冬天完全无法进入，还有路易斯安那州中部的一片沼泽地。这些远程设备及其在客户数据中心的对应设备向我们的全天候运营中心提供有关通信操作的日志数据。对于我们的操作员来说，在客户的操作员注意到问题之前，就远程站点宕机问题联系客户并不罕见。

要记录的数据量因系统和开发状态而异。在生产系统中，日志由高级数据和操作步骤组成。进行密集测试和调试的系统将记录操作步骤的大量细节，并在整个处理过程中一步一步地遵循数据和计算。该级别由故障的可能性和确定故障发生原因所需的数据决定。一些系统可能允许在运行时调整级别，而其他系统则需要重新编译。

通常最密集的是调试级别，它跟踪所有传感器读数、计算和输出，直到非常详细的级别。最不密集的可能捕获传感器、输出和直接用于确定输出的计算结果。通常至少有一个，也可能有更多的中间层可供使用。

但是不管你怎么看，认真构建和维护复杂且健壮的系统的人会在他们的设计计划中包含数据记录。如果你还没有在你的每一个项目中这样做，你应该这样做。

### 如何组织日志数据(数据记录)

我称我的系统为日志系统，以避免与对数函数的名称冲突。我的系统使用三个层次:细节、跟踪和日志。这些可以与另一个跟踪函数调用的标志结合使用。下面是一个输出文件的示例，它由四列数据组成。

```
16:17:50:125 D journal       Journal srr091213.journal opened 
16:17:50:140 D journal       Cleanup old journal files
16:17:50:140 D journal       Journal opened
16:17:50:140 D journal       Journal level: eDetail
16:17:50:140 D configuration task: search
16:17:50:140 D configuration lport: COM4
16:17:50:140 D configuration ldevice: 11
16:17:50:140 D configuration rport: COM3
16:17:50:140 D configuration rdevice: 10
16:17:50:140 D configuration mport: com5
16:17:50:140 D configuration mdevice: 12
16:17:50:140 D configuration ttlport: com6
16:17:50:140 D configuration inhibit: 0
16:17:50:140 D configuration inhibit RC: 0
16:17:50:140 D configuration update_rate: 300
16:17:50:140 D configuration name: MYSTICLAKE
16:17:50:140 D configuration task: idle
16:17:50:140 D configuration inhibit: 1
16:17:50:156 D thread        ~Thread
16:17:50:156 D main          **EXCEPTION** in APP Constructor: : COM4 Bad Serial Port Handle
```

每行的第一列是一天中的时间，以毫秒为单位。接下来是一个指示符字母，表示哪种类型的日志记录是活动的，后面是写入日志的 C++文件的名称。最后，记录实际数据，这可能因任务而异。

精确记录时间很重要，原因有几个。显然，它告诉我们事件发生的顺序，并允许基于此对日志进行排序。但是可能有其他的相关性使它变得有用。我的机器人保存了他们操作的视频，其中包含他们自己的时间戳，可以与日志中的第一个条目相匹配。

指示符字母，在本例中为“D”，表示输出来自详细跟踪。对于跟踪、日志或函数，这也可以是“T”、“L”或“F”。这表示日志记录的详细程度。当事情进展不顺利时，您需要尽可能多的数据来进行故障排除，这种详细程度设置将在我的日志中明确指出。

前三个字段是固定长度的，这允许我将它们加载到电子表格中。一旦进入电子表格，我可以根据这些字段进行排序，但仍然可以通过时间戳排序将文件返回到原始顺序。

### 通读这个例子

这个文件中的前几个条目只是日志系统的启动。第一行告诉这个日志的日期。有点旧了，2013 年 9 月 12 日。然后，它会报告旧日记文件的清理情况。这很重要，因为如果系统资源有限，大型日志文件会消耗文件系统。我用了一台装有固态硬盘的电脑，但仍然自动清除了旧文件，因为它们很快就会因代码更改而过时。

一旦日志运行，系统的配置就开始了。它读取一个 INI 文件，该文件包含要使用的资源，这些资源是一些连接到串行端口的控制板。每个板都有一个标识号，允许一个端口上有多个板。日志报告了每个控制器使用的端口和标识号。例如，左侧电机端口 lport 位于 COM4 上，标识符为 11。

配置完成后，主处理开始了，但在本例中没有开始，因为没有连接串行端口。尝试打开它失败，引发了异常。

### 使用日志数据

有一次，我遇到了一个问题，机器人会移动，因为一个未知的原因停下来，然后又开始移动。日记帮我找到了答案。关键词是:

```
16:17:53:172 D chassis kill 0 loV 1 err 121 lim 1 temp 281 targ 0 rc1 0 rc2 0

```

该行报告了从电机控制板读取的数据。文件是 *chassis* ，因为这段代码与底盘控制有关。正如你可能猜到的，问题是输入电压下降到我设置的极限以下，如“loV”为 1 所示。您还可以看到温度为 28.1°C，无线电控制输入未激活。

这显示了日志或记录的效用。如果没有这个日志，就很难确定机器人停止的原因。据我回忆，机器人试图急转弯，这导致电机失速，增加了电池的电流消耗，降低了电池电压。

使用个人电脑，我有足够的空间来存放日志，如今单板电脑(通常带有巨大的 SD 卡)的普及继续让写日志成为一个简单的选择。如果你在 Arduino Uno 上，你没有太多的空间，但你可以通过无线信道发送日志，以便在智能手机或笔记本电脑上记录。在稍微大一点的系统上，可以使用循环缓冲区将日志保存在内存中。这里的诀窍是保持单元通电，直到你以某种方式读取缓冲数据。

您还可以添加专门用于记录的板。[ada fruit Arduino](https://www.adafruit.com/product/1141)[Logging](https://www.adafruit.com/product/1141)[S](https://www.adafruit.com/product/1141)[hield](https://www.adafruit.com/product/1141)使用 I2C，而[spark fun](https://www.sparkfun.com/products/13712)[OpenLog](https://www.sparkfun.com/products/13712)使用串行连接来处理数据传输。由于这些是写入 SD 卡的，传输速度可能会限制你可以传输多少数据。如果遇到这种限制，您可能会传输二进制数据而不是文本。你的电脑或另一块板上的程序可以把二进制翻译成文本。

记录数据对于一些复杂的项目来说是一个有用的工具。值得花时间开发实用程序来帮助记录数据，而不管存储介质是什么。您保存的数据可能是拯救这一天的数据。
# 带内信令:双音多频拨号

> 原文:[https://hack aday . com/2017/09/05/带内-信令-双音-多频-拨号/](https://hackaday.com/2017/09/05/in-band-signaling-dual-tone-multifrequency-dialing/)

几十年前的一个深夜，我偶然发现了按键系统的技术描述。我正在读的这本书解释了电话上的每个键如何通过电线发送两种音调的组合，此外，它还列出了标准 12 键拨号键盘所需的七种音频。我凝视着我的 C64 Commodore，灵机一动——如果我能使用 C64 的三个音频通道中的两个来产生双音，我打赌我能拨通电话！我从床上跳起来，开始敲击一个基本程序，凌晨时分，我终于让它生成了我女朋友电话号码的可识别按键音。我把手机话筒举到显示器的扬声器前，启动程序，把听筒放到耳边，听她的电话铃声！她的父母对我的成绩没有太多印象，因为它是在凌晨 4:00 来的，但我对此相当兴奋。

自从那个灾难性的夜晚以来，我一直想知道按键系统是如何工作的，在深入研究这个主题的过程中，我发现它是一个更广泛的控制技术领域的一部分，称为*带内信令*，即使用音频或亚音频信号来控制音频或视频传输。这是非常有趣的东西，即使它不习惯在半夜无意中给某人打恶作剧电话。

### 两个音，不用等

那天晚上我探索的按键系统是美国电话电报公司试图更新脉冲拨号系统，该系统从一开始就占据了电话网络的主导地位。脉冲拨号中断环路的连续性，产生一个脉冲流，对每个拨号数字进行编码。虽然强大而可靠，但脉冲除了在中央办公室进行机电接触和在两个用户之间建立直接连接之外，并没有太大用处。长途电话需要人工接线员来接通电话，而我们现在认为理所当然或大声咒骂的功能，如语音邮件或自动语音应答系统，甚至都不可能实现。

 [https://www.youtube.com/embed/liAgTFd9Fo4?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&start=396&wmode=transparent](https://www.youtube.com/embed/liAgTFd9Fo4?version=3&rel=1&showsearch=0&showinfo=1&iv_load_policy=1&fs=1&hl=en-US&autohide=2&start=396&wmode=transparent)

T2】

DTMF 的开发就是为了解决这些问题，并开辟一系列潜在的有利可图的服务。自 20 世纪 40 年代初以来，美国电话电报公司一直在研究按钮拨号，首先是使用振动簧片的机械系统。第二次世界大战中断了贝尔实验室的大部分工作，但是战争一结束，晶体管的发明为生产小到可以装进电话机的振荡器所需的紧凑型电子设备铺平了道路。

[![](../Images/ace6a1ef745ff9aa88e3a3bb46fab601.png)](https://hackaday.com/wp-content/uploads/2017/08/front_view.jpg)

The 35-Type station dial. Source: [The Beatrice Company](http://www.beatriceco.com/bti/porticus/bell/telephones-technical_dials-touchtone.html)

贝尔实验室进行了详尽的研究，以确定音频拨号的最佳方法。他们选定了一个 DTMF 系统来控制音调，人为因素研究使工程师们对 10 个所需的数字进行了 12 键排列。这两个额外的键标有现在熟悉的星号(“星号”)和井号(“井号”)。每个键将由两个音频音调编码，一个用于该键所在的行，一个用于该列。四行音调是较低音调的音调，从 697 Hz 到 941 Hz，而三列音调的范围从 1209 Hz 到 1477 Hz。该标准还描述了 1633 Hz 的第四列音调，允许 16 键拨号盘。其中很少几个曾经被投放到消费市场，但是拥有编码 16 个字符的能力对于羽翼未丰的计算机行业来说是非常重要的。

和所有贝尔实验室的项目一样，DTMF 规范是精心制定的。低组和高组的音频音调被仔细选择以避免可能干扰音调解码的谐波。两个音调之间的总声能得到了仔细平衡，并且定义了数字和数字间周期的严格最小定时，这一点尤其重要，因为作为一种带内信令方案，DTMF 解码不能由同一信道上的人类语音触发，并且必须容忍可能存在的其他音调，如忙音或拨号音。

### 编码 DTMF

[![](../Images/4d2d69cd94b033f2009ffb722bb855ed.png)](https://hackaday.com/wp-content/uploads/2017/08/35a3a-1.jpg)

35-Type DTMF keypad. Click for larger image. Source: [Telephone Collectors International](http://www.telephonecollectors.info/)

最初的按键式拨号盘是一个坚固的工程，尽可能简单可靠。虽然我们今天已经有了 DTMF 芯片来处理生成音调，但美国电话电报公司的制造部门西方电气公司只有最简单的组件可供选择。他们围绕单晶体管振荡器制造了经典的 35 型电台刻度盘；每按下一个键，就会将两个不同的抽头电感切换到电路中，产生双音音频信号。其他开关控制振荡器电路的电源，并衰减电话听筒中听到的“侧音”,因为通过线路发送的音调必须非常大，让接收器无法解码。

许多版本的 35 型车站表盘被部署。某个时代的读者熟悉的带有方形灰色按键的经典 12 键键盘可能是最容易辨认的，公用电话中部署的加固版本也是如此——还记得公用电话吗？随着技术的进步，35 型拨号盘甚至连上了磁卡读卡器，这样，打电话的人只需刷一下信用卡就可以付费了。但是基本的编码电路保持不变。

### 解码 DTMF

[![](../Images/6e8e7748547f7242e6ea3b22ffb63b3d.png)](https://hackaday.com/wp-content/uploads/2017/08/decoder.png)

An original Bell System DTMF decoder. From [*Ciarcia’s Circuit Cellar, Vol. 3*](https://books.google.com/books?printsec=frontcover&id=zAsN0XCHbFsC#v=onepage&q&f=true) copyright 1982

在接收端，DTMF 信号很容易解码——至少现在是这样。我们在一个封装中集成了 DSP 芯片来完成这项工作，或者我们可以利用锁相环来构建一个简单的电路。但是电话公司在 20 世纪 60 年代是如何做到的呢？

令人惊讶的是，很难找到关于原始 DTMF 解码电路的可靠信息。大多数贝尔实验室期刊的原始文章都是收费的，所以挖掘原始文献是很困难的。我确实设法找到了一些原始解码电路是庞大而昂贵的带通滤波器阵列的参考资料，不可或缺的史蒂夫·西亚[在 1982 年*西亚的《电路地窖》第 3 卷*中简要讨论了这些参考资料。在同一篇关于使用 DTMF 控制构建家庭自动化系统的文章中，Ciarcia 使用 100 多个独立器件构建了一个基于 567 音频解码器芯片的全功能解码器。显然，在 DSP 芯片和硬件实现](https://books.google.com/books?id=zAsN0XCHbFsC&lpg=PP1&pg=PA210#v=onepage&q&f=true) [Goertzel 算法](https://en.wikipedia.org/wiki/Goertzel_algorithm)出现之前，解码 DTMF 比编码要困难得多，但只需要在交换机上完成。

### DTMF 无处不在

很难知道最初为带内信令设计 DTMF 系统的工程师是否真的知道他们在做什么。他们正在寻找一种更灵活的电话网络用户界面，这种界面将简化和自动化连接业务，并实现人们愿意支付高昂费用的呼叫等待和呼叫转移等功能。诚然，他们的系统给了我们讨厌的“语音邮件监狱”，但 DTMF 认为带内职责远远超出了贝尔实验室的初衷，从控制业余无线电中继器到通知当地电视台何时打开和关闭其附属网络馈送。

在本系列的后续文章中，我们将探索更多的带内信令技术。
# 谜谜:谜机是如何工作的

> 原文:[https://hack aday . com/2017/08/22/the-enigma-enigma-how-the-enigma-machine-worked/](https://hackaday.com/2017/08/22/the-enigma-enigma-how-the-enigma-machine-worked/)

对许多人来说，英格玛机器是一个谜。但这真的很简单。以下是从基础到全机的一步一步的讲解。

恩尼格玛机可能是人类历史上最伟大的专用密码机。恩尼格玛机是一种打字机大小的机器，包括键盘，二战期间德国人用来加密和解密信息。它也是波兰密码局和英国布莱奇利公园的那些人想出如何破译或破解的机器之一。最近，关于它是如何被打破的故事成为电影《模仿游戏》的主题。

让我们从基础开始。

## 一种简单的替代密码

大多数人都见过如何使用这样的简单密码来加密消息。

![Simple substitution cipher](../Images/fb507045424a721f930a8ed73882fa60.png)

Simple substitution cipher

假设我们要加密单词`Hackaday`。这被称为明文消息。我们会将所有字母视为大写。使用上面的密码，我们在第一行寻找`H`，并用下面的字母代替`Z`。类似地，在顶行中寻找`A`，我们看到我们应该用`G`来代替它。加密文本变成`ZGTBGNGV`。这就是所谓的密文。为了解密它，我们做相反的事情，寻找底部行中的每个字母，并用顶部行中相应的字母替换，得到`HACKADAY`。

这是最基本的。让我们像英格玛机那样更进一步。

## 添加转子

![Simple substitution cipher with wires](../Images/048bfeec735181d7f9a9a921d12ec7c6.png)

Simple substitution cipher with wires

我们可以将密码重绘为两个字母，字母按字母顺序排列，并在成对的字母之间画线。这种情况下效果是一样的。但是这些线可以是电线，电连接每一对线，这就有可能很容易地改变替换映射到密文的方式。

![Rotating substitution cipher](../Images/35f5e754261c5d3856548b427dc7a4bf.png)

Rotating substitution cipher

![Enigma rotor wiring](../Images/4bb834ee5f6e707888b8aa7ca5b97f84.png)

Enigma rotor wiring

改变映射的能力很重要，因为一旦有人推断出`G`是`A`的替代，他们就会知道密文中的每个`G`都是如此。一个改进就是改变所有这些配对。更好的是，如果每次一个字母被编码时它们都会改变。

一种容易实现的方法，也是 Enigma 中的方法，是将所有线路嵌入一个轮子/转子中。通过转动转子，同时保持字母静止，字母之间的连接发生变化。一个回合之后，`A`现在将被之前的`Z`所取代，即`J`。重复这一替换步骤，然后为每个字母转动转子，`HACKADAY`变成了`ZJGZLVFA`。按照上图，你会注意到第一个`Z`来自`H`，但是第四个位置的`Z`来自`K`。

![Enigma rotors with alphabet rings](../Images/69c7455e1cc645414e73a5d0f1590154.png)

Enigma rotors with alphabet rings

在转子中，每根导线的两端都有外部触点。这允许多个转子并排放置，相邻的触点接触。并且在内部，每个转子被不同地接线，即每个转子包含不同的密码。一些恩尼格玛机有三个转子，最常用的是八个。如照片所示，从一个真实的谜，每个转子也有一个附加的字母环，它与转子一起转动，用于设置转子的初始位置。

## 惊人的可能性

![Enigma machine](../Images/2ed69a9472b99cfa3e3de173c6bada31.png)

Enigma machine

对于字母`A`，通过三个转子有多少种可能的路径？请记住，每个转子都可以转到任何位置。这意味着对于第一个转子，`A`有 26 条可能的路径。但是一旦我们沿着线穿过第一个转子，现在有 26 条可能的路径穿过第二个转子。然后通过第三个有 26 条可能的路径。因此，`A`通过所有三个转子的可能路径总数是 17576。

```
26 x 26 x 26 = 17,576
```

正如我们所说，每个转子是不同的有线。因此它们被用罗马数字命名:I、II 和 III。但对于任何可能拥有这种机器并试图解密信息的人来说，更复杂的是，转子在使用前可以移动。转子 II 可能在左边，转子 III 在中间，转子 I 在右边。为了增加更多的可能性，总共制造了多达八个转子，每个转子都有自己的线路和罗马数字:IV、V、VI、VII 和 VIII。德国陆军和空军使用了 5 架，海军使用了多达 8 架。在使用之前，对于三转子机器，将从许多转子中选择三个转子。

假设我们试图解密一条军队信息，我们可以从五个转子中选择一个用于左边的转子，然后从剩下的四个转子中选择一个用于中间的转子，然后从三个转子中选择一个用于右边的转子。这就给出了 60 种可能的方式来选择三个转子来传递信息。

```
5 x 4 x 3 = 60
```

由于一封信通过转子有 17576 种可能的路径，所以总共有 1054560 种可能性。

```
17,576 x 60 = 1,054,560
```

## 只有转子的英格玛机器

![3-rotor Enigma circuit](../Images/f3cbfa0b4c22ff0ac201aef052c7cfb3.png)

3-rotor Enigma circuit

为了使谜易于使用，增加了一个电路，包括电池、键盘和用于显示的发光字母。插图中显示的只是几个按键和点亮的字母，以及转子中的几根电线。

电池的一侧连接到所有的灯，用于照亮一些字母。当“A”键被按下时，该键的开关与电池的另一端连接。开关的另一端向上连接到入口轮，该入口轮与第一转子上的一个触点电接触。从那里，电路继续通过其他两个转子，遵循这些转子内的电线路径。在转子的另一端有一个叫做反射器的东西，它使电路沿着路径通过转子返回，直到它在入口轮的一个触点处出现。从那里电路转到`F`键。因为没有按下`F`键，所以仍然与`F`灯电接触，完成与电池的电路并点亮它。点亮的`F`表示被按下的键`A`应该被替换为字母`F`。接线员或其他人记下这一点。

这里未示出的一种机制是由于按键而导致一个或多个转子转动的机制，称为翻转。每按一次键，第一个转盘将转动一个字母位置，如上面的密码所示。在某些型号的机器上，只有在第一个转子转了一整圈后，第二个转子才转一个位置。然后，第二个转子每转一圈，第三个转子就转动一个位置。但所有这些都因版本不同而不同，有些转子右侧的转子每转一圈就转两圈。

## 添加插板

![Enigma plugboard](../Images/4fb942685146cb2f6bb22e915e050ba8.png)

“Enigma plugboard” by Bob Lord CC BY-SA 3.0

![Enigma circuit with plugboard](../Images/fd3486fd1be683058ed7972bc7de5a04.png)

Enigma circuit with plugboard

1930 年，德国军队版本增加了插板，或 steckerbrett。这允许交换字母。在所示电路中，`D`和`F`被交换。当按下`A`时，正如我们在上面看到的没有插板的情况，输出将是`F`。但是对于插板来说，它是`D`。相反，如果我们将`D`与`A`交换，那么交换会在到达转子之前影响电路，转子会从`D`开始。按照这条线路，输出应该是`G`。

因为有 26 个字母，所以最多可以进行 13 次交换，但通常只有 10 次。计算连接插板[的可能方式的数学方法有点复杂](https://youtu.be/G2_Q9FoD-oQ?t=6m15s)，但是数字是 150，738，274，937，250。将它乘以我们上面给出的其他可能的组合，我们得到一个字母可以被替换的可能路径的总数是 158，962，555，217，826，360，000。

## 缺陷

操作者使用机器的方式有一些缺陷，大多数都没有遵循程序。但是就机器的设计缺陷而言，主要的缺陷与反射器有关。

反射器使得谜[自反](https://en.wikipedia.org/wiki/Involution_(mathematics))。这意味着，在相同的起始条件下，机器既能加密也能解密。用上面的例子来说明插板，当你按下`A`按钮时`D`灯亮，但是按下`D`按钮时`A`灯亮。这意味着，忽略插板，一封信永远不会取代自己。这个事实有助于密码破译者破解这个谜。

## 变化

我们已经在上面提到了一些变化，例如转子的数量，插板的存在，以及转子转动的点。

不同版本的机器之间的另一个差异是键盘与输入轮的连接方式。在商用机器中，它们按照 [QWERTZ 键盘](https://en.wikipedia.org/wiki/QWERTZ)连接:Q-A、W-B、E-C 等等。在军用机器中，它们是按字母顺序连接的:A-A、B-B 等等。

在一些版本中，反射器也可以旋转，在一些情况下在使用前仅旋转一次，在其他情况下自动旋转。

我们已经讨论过设置转子的初始位置。为了做到这一点，转子上有一个字母环，他们通过转动转子来设置它，直到一个想要的字母出现在一个小窗口中。然而，在后来的机器版本中，字母环本身可以与有线转子分开转动。这意味着最初要为转子设置两件事情，字母环，称为环设置，然后是整个转子。

## 使用谜机

[![German Air Force Enigma key list with reconfigurable reflector](../Images/e501bf45b328d3f79acd0f729af8716e.png)](https://hackaday.com/wp-content/uploads/2017/08/enigma_keylist_3_rotor.jpg)

German Air Force Enigma key list with reconfigurable reflector

由于 Enigma 机器有如此多的版本，在使用它之前有许多不同的可能设置需要配置。通常，加密信息的人和解密者都有一个设置列表，有时每天都有不同的设置。

这里给出的示例设置中的一些列是:

*   车轮顺序(Walzenlage):将哪些转子放入机器。记住，每个转子都是用罗马数字命名的，
*   环设置(Ringstellung):字母环相对于带字母环的型号的有线转子的位置。
*   插头连接(Steckerverbindungen):哪些字母与其他哪些字母互换，

进行加密的人会自己选择随机的转子位置，并将它们包含在消息的开头。在第二次世界大战后期，这样做的程序如下。他首先创建一个初始起始位置，例如 ABC，和一个消息键 DEF。他将转子设置为 ABC 并输入 DEF。假设加密到 GHI。接下来，他将转子设置为信息键 DEF，并开始输入明文信息。他会记录输出，也就是密文。然后，他会发送初始起始位置 ABC、加密的消息密钥 GHI，然后是密文。

在接收方，解密消息的人将转子设置为接收到的前三个字母 ABC，并键入接下来的三个字母 GHI。输出 DEF。从上面看，你会看到加密信息时使用转子设置的结果。所以他把转子设定为 DEF 并开始输入密文。输出是明文消息。

对于那些看过电影《模仿游戏》的人来说，一个有趣的补充说明是，你可能会想起关键的酒吧场景，在那里艾伦·图灵了解到一个操作员总是在他的信息开始时发送相同的字母，而不是他们应该发送的随机字母。他指的是我们上面谈到的随机选择的转子位置。

观看所有这些设置在使用前被应用的一个有趣的方式是观看我们文章中的视频[关于手表中的一个令人惊奇的谜](http://hackaday.com/2015/03/23/enigma-machine-wristwatch/)。

## ZGMMVXZGTBUOQ

你有使用英格玛机的经验吗，或者用其他方法加密过吗？有一点是清楚的，黑客读者和作家都从 Enigma 机器中获得了某种乐趣——也许是因为它是一种智能机电野兽，或者是因为加密和解密信息的乐趣。也许你可以在下面的评论中为我们解开这个谜团。

这里有一些在这里发现的更古老的创作，从一个被破解成谜机的玩具开始。然后是这个[基于 Arduino 的谜，led 伪装成谢妮管](http://hackaday.com/2013/10/07/arduino-based-enigma-replica-is-fully-functional/)。这里再一次展示了[手表中的神奇之谜](http://hackaday.com/2015/03/23/enigma-machine-wristwatch/)。
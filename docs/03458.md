# 在任何网络上展示你的树莓派

> 原文:[https://hackaday.com/2016/09/20/expose-your-raspberry-pi/](https://hackaday.com/2016/09/20/expose-your-raspberry-pi/)

这些天每个人都在谈论物联网。如果你是一个长期的 Hackaday 读者，我会想象你和我一样，会想:“那又怎么样？”多年来，我们一直在构建联网嵌入式系统。早在 2003 年，我写了一本名为《嵌入式互联网设计——省省你的钱吧，它现在已经过时了，它描述的硬件都过时了。但我的观点是，物联网不是这个十年的产物。只是名字是。

好消息是——如果你可以这么说的话——网络几乎无处不在。这意味着你可以把以前从未有过的东西联系起来。这也意味着你得到了大量的数据，你必须找到一个使用的理由。早在 2003 年，要在互联网上找到一块冲浪板并不容易。我使用的 TINI 板(后来命名为 MxTNI)有一个以太网端口。但是你的烤面包机或者洗衣机在那个年代很可能旁边没有电缆。

今天，像 Raspberry Pi、Beagle Bone 和它们的许多模仿者这样的主板使得在网络上获得一台小型的功能性计算机变得很容易——有线的或无线的。无线无处不在。如果不是，可以做 3G 或者 4G。如果你在乡下，你可以考虑卫星电视。所有这些选项比以往任何时候都更便宜。

## 问题是

还有一个问题。当然，网络无处不在。但是这个网络明显倾向于让你接触外面的世界。想看 CNN 或网飞吗？当然可以。但是把你的电脑变成服务器就有点不一样了。大多数低成本网络选项是不对称的。他们下载的速度比上传的速度快。除了花更多的钱在你的网络提供商身上，你对此无能为力。而且，大多数廉价的选择是公开一个 IP 地址，然后进行网络地址转换(NAT ),将服务分发给本地设备，如 PC、电话和平板电脑。更糟糕的是，您与他人共享该公共地址，因此您的 IP 地址可能会因一时兴起而更改。

例如，如果你想把一个树莓派放到网络上并曝光，你会怎么做？如果你控制了整个网络，这并不难。您通常使用某种动态 DNS 服务，让 Pi(或任何计算机)告诉一个众所周知的服务器它的当前 IP 地址(见下图)。

[![NetworkDiagram1](../Images/1497d71dc104c2cc4191f578b7e56b2f.png)T2】](https://hackaday.com/wp-content/uploads/2016/09/networkdiagram1.png)

那个著名的服务器回答 DNS 请求(将 hackaday.com 转换成真实 IP 地址的东西)。现在任何人都可以找到你的圆周率。如果您有硬件和/或软件防火墙(这是一个很好的赌注)，您还必须打开防火墙端口，并告诉 NAT 路由器您想要在给定的端口上服务流量。

## 外星网络

如果你在家，并且控制着所有的网络接入和硬件，那就没问题了。但是假设您不确定您的系统将部署在哪里。例如，您可能会通过 3G 调制解调器在不同的交通路口使用您的盒子。或者，您已经制作了一个智能相框，放在医院或疗养院中，并且希望通过该机构的 WiFi 进行访问。

当然，你可以把它作为一个系统设计问题来处理。对于假设的图片框架，它可能会定期检查公共互联网上的 web 服务器以获取新内容。当然可以。你能做到的。直到你需要 ssh 到盒子里做一些更新。有时候你只需要找到有问题的盒子。

## 解决方法

对于这种情况有几种选择。NeoRouter 拥有适用于许多平台的软件，可以创建虚拟专用网络(VPN ),这似乎是一个新的网络接口，所有参与者都是本地的。如果我的台式计算机的 NeoRouter IP 地址是 10.0.0.2，而我的 Pi 地址是 10.0.0.9，那么我可以简单地通过 ssh 连接到该 IP 地址。如果 Pi 在地球的另一边也没关系。流量将安全地通过公共互联网，就好像两台计算机直接连接，中间没有防火墙或任何其他东西。

老实说，这听起来很棒，但我发现设置起来有点困难。它本身也不是很有用。你需要运行某种服务器，比如网络服务器。您还需要在公共互联网上安装一台带有开放端口的 NeoRouter 服务器。

## 更好的答案

我最终使用的是一个名为 [Pagekite](https://pagekite.net/) 的服务。这些软件都是 T2 的开源软件，在他们的服务器上有合理数量的免费使用。我会继续在我自己的服务器上设置所有的东西(我将在下一次讨论)。但是现在，假设你很乐意使用他们的服务器。

如果你去 Pagekite 网站，他们有一个非常简单的“飞行计划”让你开始:

```
curl -s https://pagekite.net/pk/ | sudo bash
pagekite.py 80 yourname.pagekite.me
```

[![networkdiagram2-redo](../Images/3ca0fbda7b68e51c3782474d58965793.png)](https://hackaday.com/wp-content/uploads/2016/09/networkdiagram2-redo.png) 就是这样。老实说，你不了解这些人，所以我不会建议你从网上下载一些东西到我的 root shell 中。然而，它是安全的。为了确保我确实将 curl 中的脚本重定向到一个临时文件中，检查它，然后运行它。您也许可以从您的存储库中安装 Pagekite，但它可能是一个旧版本。他们在 [GitHub](https://github.com/pagekite/PyPagekite) 和 repos 上也有很多包系统的常用包(像 [deb 包](https://pagekite.net/wiki/Howto/GNULinux/DebianPackage/)和 [RPM](https://pagekite.net/wiki/Howto/GNULinux/RpmPackage/) )。

PageKite 背后的概念是反向代理。远程计算机和用户都通过 DNS 找到 PageKite 计算机(见下图)。该服务器充当中间人，因为几乎所有网络都允许访问 web 服务器，所以应该没有防火墙问题。

最后一行设置了从指定 URL 到本地机器端口 80 的重定向。到目前为止，这与使用 NeoRouter 没有太大区别。然而，pagekite 脚本有点意思。它可以是后端(也就是提供网页内容的 Raspberry Pi)，也可以是前端(比如 yourname.pagekite.me 上的服务器)。它还有一个简单的 web 服务器。因此，如果您想提供来自/home/pi/public_html 的页面，您可以编写:

```
pagekite.py /home/pi/public_html yourname.pagekite.me +Indexes
```

有一种方法可以添加这样的东西，这样当 pagekite 启动时它们就开始了(阅读关于[-add 选项](https://pagekite.net/wiki/Floss/TechnicalManual/))。这一切都行得通，而且行之有效。

您也可以重定向其他端口。甚至有一种方法可以隧道传输 SSH 流量，尽管它需要为 SSH 客户端设置一个代理。这取决于你使用的 ssh 程序。虽然这有点麻烦，但也很方便，因为它允许您 SSH 到远程机器，即使在限制性的工作或学校网络上。

第一次运行脚本时，Pagekite 会给你一个注册的机会。但是，您确实需要在一台可以打开浏览器的机器上，所以如果您正在使用您的 Pi headless，您可能希望首先在另一台机器上设置帐户。

这个免费账户有一些限制，但是它允许你设置一个 [CNAME](https://pagekite.net/wiki/Howto/CnamePageKites/) 来重定向你自己的域名。您还可以创建无限的子域(例如，toaster.myiot.pagekite.me、washer.myiot.pagekite.me 和 alarmsystem.myiot.pagekite.me)。

## 独立地

如果你没有公共电脑，也没有大量的数据传输需求，Pagekite 免费计划可能正好适合你。我不想使用他们的域名或者受制于他们的配额，所以我决定把前端安装到我自己的网络服务器上。代码是开源的，但是实现它的文档并不多。

幸运的是，下一次，我将带您通过我采取的步骤让它全部工作。这并不难，但确实需要一点思考、文本编辑和 DNS 灵活性。
# 本周失败:如何不建立自己的 DGPS 基站

> 原文:[https://hack aday . com/2018/03/30/fail-of-the-week-how-not-to-build-your-own-DGPS-base-station/](https://hackaday.com/2018/03/30/fail-of-the-week-how-not-to-build-your-own-dgps-base-station/)

GPS 是关于一个人在世界上的位置这一古老问题的现代答案，但它也有其局限性。这取决于你上方两万公里的卫星发射的无线电信号的飞行时间。像任何涉及大距离和高速度的系统一样，这必然会给精确测量带来一些挑战，从而限制可实现的精度。换句话说:全球定位系统的位置往往会偏离几米，这是基于基本的操作原理。

今天的精度水平在几十年前几乎是无法达到的，而我们用手持设备只需几秒钟就能达到这样的精度。难以置信！然而，目标在继续改变，人们正在努力消除剩下的错误。该解决方案被称为差分 GPS 或“DGPS ”,其概念看起来出奇的简单。

令人着迷的是，你可以用一个 GPS 精确测量另一个 GPS 的误差。这是因为已知 GPS 定位的固有误差是局部恒定的。彼此相邻的两个接收器拾取以相同方式受到影响的信号，因此可以预期计算出相同的错误位置。这适用于单个接收器之间长达几千米的距离。因此，为了消除误差，您只需要一个位于已知位置的 GPS 接收器来测量当前偏差，并向其他单元发送校正信息。DGPS 就是这样做的，在一些地区使用地面无线电，在另一些地区使用卫星。移动解决方案也存在。

因此，在已知位置安装 USB GPS 加密狗的 raspi 应该能够充当 DGPS IP 基站，对吗？理论上，是的。实际上…失败。

## 设置基站

[![](../Images/8ae075c067fc6425fb4630a4a0e15522.png)](https://hackaday.com/wp-content/uploads/2018/03/p1030354.jpg)

This is what a homebrew DGPS station looks like

一个完整的 DGPS 系统的硬件是非常小的，而且非常便宜。许多必需品你可能已经准备好了。

基站只不过是一台连接到互联网和 GPS 模块的计算机。在这种情况下，我使用零件箱中的树莓 Pi。我用 5 米长的 USB 延长线连接了一个 USB GPS 接收器加密狗。重要的是将它安装在一个已知的位置，这是一项你可以租用的任务，但自己动手做更有趣，我马上就要谈到这一点。

对于接收硬件，我打算为智能手机提供精确的初始定位，作为增强现实项目的一部分。我并没有完全实现，所以我用上网本和手持 GPS 取代了 Android 应用。

第一步是为接收站找到一个合适的位置，并使一切不受天气影响。我家后院的烧烤屋为 raspi 人提供了庇护所，甚至电力。GPS 加密狗被用拉链绑在一根竹子上，并用塑料袋包着。过长的电缆有一个很好的松弛度，所以雨水在到达电脑之前就会流下来。

## 软件方面

在 Linux 下安装和读取加密狗的输出非常容易。接口是 USB 串行接口，协议是标准文本。要让它工作，只需要我关闭相关端口的回显，然后读取从加密狗中流出的内容。NMEA 0183 是一个很好的记录标准，足够的人可读。让事情变得更简单的是，用于处理[【NMEA】](https://github.com/Knio/pynmea2)和地理空间数据的 Python 库已经存在，并且运行良好。

如前所述，了解基站的确切位置对这个项目至关重要。有几种方法可以获得它。你可以雇一个测量员来精确测量天线的位置，或者获得一张足够精确的现场地图。你也可以诉诸暴力:假设 GPS 误差在时间上是均匀分布的，只要记录足够多的位置并将它们平均就可以得到正确的位置。因此，我开始将 GPS 修复写入一个文件，并让安装搁置四天。这为我提供了超过 70，000 个修复，这些修复被输入到 Python 脚本中进行清理和平均。用 OpenStreetMap 进行交叉检查，结果就在我家后院海平面以上，所以我很有信心。

剩下的工作就是编写一个脚本，持续监听 GPS，减去已知的位置来获取当前的误差，再减去另一个位置来将信息发送到网络上。再一次， [Python](https://www.linuxjournal.com/content/tech-tip-really-simple-http-server-python) 让这变得简单，现在我有了你可能称之为错误信标的东西。

## 客户端硬件和软件

![](../Images/d53c1b7364f5ba7c0d44d3acd20df6df.png)

Both GPS receivers that were used. Note the home made USB cable for the hand held. Ignore the stains on the table.

该客户端最初的目标平台是 Android。这不是我熟悉的环境，在阅读了 Android 定位服务的文档后，我推迟了应用程序，而是决定首先建立一个测试平台。我用了一个上网本和一个手持 GPS，几年前我为它做了一根 USB 线。

该软件无非是通过 HTTP 获取基站计算的校正值，然后从 GPS 提供的定位值中减去该值。为了评估这个解决方案的性能，客户机被放置在我的后院，并被设置为在一段时间内记录纠正的修复。如果我的实现有效，记录的位置应该是固定的，并精确地指示我的花园椅子的位置。

## 为什么会失败？

[![](../Images/301ce0208a5c585d46c63aca2df07617.png)](https://hackaday.com/wp-content/uploads/2018/03/p1030378.jpg)

Detail of the connector I made for the Garmin in pre- 3D printer times. Not shown: The tons of hot glue that keep cable and pins in place.

这是一个“失败的一周”，所以我敢肯定，你已经猜到我的位置数据从这个测试是完全不可靠的。这些位置显示了与我之前用来定位基站的原始数据相同的扩展量！

显然有些事情没有像预期的那样工作。我检查了我的代码中的错误，然后尝试了一些随机修改，希望偶然注入正确性，最后休息一下做了这个项目的第一步:测试我对 DGPS 工作原理的假设。

为了实现这一点，GPS 加密狗和手持设备都测量了一个小时的位置，同时将两个接收器紧挨着放置。NMEA 为每个定位提供了时间戳，因此很容易将两个设备的测量值关联起来。事实证明，即使 GPS 误差在本地是恒定的，它影响单个接收器的方式可能是不同的。

## 成功之路是什么？

![](../Images/a7fa9af7ac1f154b24ae3e71c903a3b2.png)

The positions logged by both devices over the course of one hour. The line connects two simultaneous measurements, the number shows the distance in meters.

有人会说，你应该总是测试你的基本假设。“永远不要假设任何事情”是在各种发展中经常重复的咒语。但是有时这是不可行的，并且通常假设从常识中是不可辨别的。

例如，当建造一个自主水下机器人时，你真的想在开始之前测试水的湿度、铅的浮力以及湿气对电子设备的影响吗？德语为这种情况提供了“感知知识”一词。感知的知识有时是危险的，但往往难以避免，也总是难以识别。

到目前为止，这个项目让我熟悉了 GPS 的复杂性，认真复习了我的 bash-fu，并让我最终建立了我的第一个互联网连接的东西。它不像预期的那样工作，这就是我想利用 Hackaday 评论部分的力量的地方。你认为这个 DGPS 系统的基础已经到位了吗？像这样一个简单而廉价的系统如何才能回到正轨，并最终实现比单个商用 GPS 接收机更高的精度？

我希望我们能一起把这篇关于从失败中学习的文章变成一篇题为“如何建立你自己的 DGPS 基站”的文章。

## 附加说明:

*   一组意大利研究人员已经成功完成了 IP DGPS，在山区以分米精度定位自主机器人。我没有抄袭他们的方法，因为不知何故我再也找不到他们的论文了。
*   本地 DGPS 用于农业，我强烈怀疑这些设备采用 WiFi 或蓝牙作为通信层，因为它易于使用，可以省去许多关于无线电法律方面的麻烦。
*   净化你的确切位置的软件，旨在提供这是一个主要的工作。此外，我的剧本还没有被写得经得起公众的审查，所以我现在会把它们留给自己。
# 定制、手工制作的可执行文件

> 原文：<https://hackaday.com/2015/10/12/bespoke-artisanal-hand-made-executables/>

程序员和软件工程师将永远使用最新的开发环境、最时尚的框架和他们 21 天前才学会的语言。如果不是这样呢？如果开发人员将注意力放在他们的技术上，并编写具有旧世界魅力的程序，会怎么样？如果 Windows 可执行文件像手工制作的柴火或自由放养的格兰诺拉麦片一样有耐心会怎样？[【史蒂夫】做到了](http://www.bigmessowires.com/2015/10/08/a-handmade-executable-file/)。他正在打造一条通向真正手工制作的可执行文件的道路。

您可以在 Windows 平台上运行的最简单的可执行文件只是一个简单的。COM 文件。这是一个非常简单的文件格式，只包含加载到 0100h 中的代码和数据，以及到代码中另一点的跳转。DOS。EXE 文件格式[稍微复杂一点](http://www.delorie.com/djgpp/doc/exe/)，但也没复杂多少。[Steve]的目标是在没有编译器、汇编器、链接器或其他任何东西的情况下构建一个合适的 Windows 可执行文件。

当然，将可执行文件删减到最少的过程是从创建程序开始的。在这种情况下，测试程序只返回一个数字。这个程序是用 BuildExe()函数创建的，它首先创建一个有效的 [Windows PE 头文件](https://en.wikipedia.org/wiki/Portable_Executable)。接下来是一个“可选的”头文件，包含可执行文件每个部分的值、入口点地址和第一部分数据的偏移量。可选标题之后是一段数据目录，以及几个字节的簿记。最后，有四个字节的[史蒂夫]的代码。原始可执行文件的总大小？516 字节。

在对 BuildExe()函数进行了一些优化之后，[Steve]设法将他的可执行文件的大小降低到 300 字节，但是发现任何小于 328 字节的文件都无法运行；操作系统为可选的头和数据目录设定了一个最小大小。在末尾填充了 28 字节的填充之后，[Steve]得到了一个 328 字节长的可执行文件。

[Steve]可以尝试另一种技术——将 PE 报头和可选报头的一部分与第一个 DOS 报头重叠。原来 DOS 头的唯一重要部分是前两个字节——“MZ”，这是最初的 DOS 开发者之一的神奇数字和首字母。通过保留“MZ”并把其他需要的数据放入空的 DOS 头文件中，[Steve]设法把他的可执行文件压缩到 268 字节。这是 Windows 7 64 位版本下可执行文件的绝对最小大小。Windows 足够聪明，可以防止四个字节长的。所以除非你想回到糟糕的 Windows 版本，否则这可能是今天 Windows 运行的最小的可执行文件。
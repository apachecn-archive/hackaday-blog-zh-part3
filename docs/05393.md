# 差分集成电路导论

> 原文:[https://hack aday . com/2017/03/31/an-介绍-到-微分-i%c2%b2c/](https://hackaday.com/2017/03/31/an-introduction-to-differential-i%c2%b2c/)

几周前，我们讨论了在长电线上运行 I C 的禁忌。用于原型制作？是啊！但是对于一个防弹的生产环境，这种实践是不合适的。这个月，我从一堆解决方案中挑出了我最喜欢的，并试了试。具体来说，我用 PCA9615 组装了一个*差分* I C (DI C)设置，以便与一系列博世 IMU 对话。看:一个 IMU 面条诞生了！去喝杯咖啡，和我一起用 DI C 的螺母和螺栓武装你，这样你也可以像老板一样在长长的电缆上运行 I C。

## 差分信号有什么好奇怪的？

有很多方法可以让 I C 的通信线路更加抗噪。从我们讨论的所有选项中，我选择了差分信号。它们很简单，相当标准化，而且非常优雅，不容忽视。让我们花点时间做一个简短的“差分信号 101”讲座。希望你已经含有咖啡因了！

假设我们有两台设备想要通过单条线路进行通信。为了开始对话，我们通过一根长电缆将单端信号从一台设备传输到另一台设备。想象一下在试验板之间有一条长长的连接线。让我们假设发送方发送一个数字输出(逻辑 0 或逻辑 1)，而接收方期望接收一个数字输入(逻辑 0 或逻辑 1)。

![](../Images/8688cf51ef5cea69e168216c95b86f45.png)

现在，假设我们通过引入附近的电机并开启它来增加一些电磁干扰(EMI)。根据法拉第定律，电机不断变化的磁场会在这些导线上感应出电压，我们会将其视为电压尖峰。

![](../Images/a56e39ba37ee9dfba6db8e29847604fa.png)

如果这些尖峰足够强，接收器会将这些信号视为数字输入，即使它们本来就不应该出现在那里！会发生什么？因为我们没有准备好接收这些信号，所以它是未定义的，任何事情都会发生！我们的编码器将读取随机数，步进器将采取额外的步骤，按钮将显示:*按下*，火箭将发射，卫星将脱离轨道，我们被解雇了。

抛开伤害不谈，现在让我们用差分信号连接发送器和接收器。

![](../Images/cc15aa37759a6157e12ee583024bf667.png)

在该设置中，接收器读取顶部和底部通道之间的*差*。发送器通过在两条线路上同时施加大小相等方向相反的电压来传递逻辑 1。差分信号的美妙之处就在于此:如果我们假设两个信号都受到噪声源的同等影响，那么它们都会拾取等量的噪声。因为两个通道的噪声信号之间没有*差异*，所以接收器什么也没有读取到。噪音是看不见的！
![](../Images/c9d0bceeeeee6923009336a03b6ccda1.png)

记住:我们假设两个信号都同样受到噪声*的影响*。为了做出这样的假设，我们需要将差分对导线尽可能靠近，这意味着要么是带状电缆(如 LVDS)，要么更好:双绞线(如 USB 或以太网)。

## IMU 面条的起源

为了让每个人都跟上 DI C 的潮流，我开始着手一个展示 DI C 最佳状态的项目。我渴望做一个 [IMU 面条](https://hackaday.com/2012/04/26/modeling-an-object-with-internal-imus/)已经快三年了。直到现在，有了 DI C 和 BNO055，大部分基础工作才得以完成；我所需要做的就是把这些碎片放在一个干净的包里，再加上一点数学运算。我对这个项目的看法是，通过 DI C 将一群唯一可寻址的节点连接在一起。我将把 IMU Noodle 的细节留到以后的文章中。现在，让我们把重点放在沿着每个节点运行并使这个项目成为可能的 DI C 的具体细节上。

### 与迪·C 相处融洽

简而言之，DI C 并不太复杂。我们都非常熟悉传统 I C 的 SDA 和 SCL 信号。PCA9615 只是将每个信号分成两个差分对，总共有四条通信线。任何想跳到 DI C 总线上的芯片首先需要将其 SDA 和 SCL 线转换成相应的 **P** lus 和 **M** inus 差分对信号: **DSDAP** 、 **DSDAM** 和 **DSCLP** 、 **DSCLM** 。之后，通信可以正常开始，无需更改软件。

[![](../Images/be7c6f26260192fd7a752b49062c94ad.png)T2】](https://hackaday.com/wp-content/uploads/2017/03/pca9615_di2c_setup1.png)

最后一个问题:承载 DI C 信号的实际电缆的起点和终点需要安装*终端电阻*。这些电阻的规格与电缆本身的*特性差分阻抗*相匹配。(请在电缆数据表中找到该值。)在你们回家尝试构建没有它们的系统之前，听我说:这些电阻是*必需的*。如果没有它们，沿着电线传输的信号会反复反射回来，直到消失。当然，我们当然不能让旧数据的假拷贝干扰新数据。只需增加合适的端接电阻就可以解决这个问题。

### 设置阿迪 C 配置

PCA9615 有几个设置阿迪 C 总线的选项。我选择了多点总线配置。

![](../Images/303de5ca9bd2fbb62c0df9df88bae127.png)

Image Credit: PCA9615 Datasheet

在上面的设置中，每个“卡”都有一个本地 I C 总线，它连接到一根电缆上，形成一个共享的 I C 总线。每个卡上的 PCA9615 在开漏端和差分端之间进行来回转换。这些卡一起形成了一条大总线，这意味着所有地址必须是唯一的。我选择这个解决方案是因为它简单；每个 IMU 都位于一个专用板上，并将其数据中继回电缆起点的一个主机。在电缆末端，最终 IMU 节点*也*用适当的终端电阻终止 DI C 信号。

![](../Images/b9317e415e15a4b51e0402b5486d650d.png)

They do come cheaper by the dozen. Fab and assembly thanks to PCBWay.

这种配置有一个主要好处。除了最后一个节点，每个节点都具有完全相同的拓扑。由于印刷电路板通常一个面板一个面板地变得更便宜，将一个*设计制作 10 到 20 次要比制作多个设计便宜得多。最后，为了处理最终电路板需要端接电阻的边缘情况，我在每个 IMU 节点上放置了可选的端接电阻，但只有最后一个*电路板安装了端接电阻。**

当涉及到设置阿迪 C 节点的实际分立器件时，非常简单。

![](../Images/5a03b5385d78afc4535c79dc65d75a01.png)

这张原理图只是一页上杂乱的数据手册建议，还有一些旁路电容。请记住，端接电阻只能安装在 DI C 链的第一个和最后一个节点上。对于所有其他节点，应该省略它们。

边注:这个芯片*有*在两个不同的电压下运行 DI C 信号和本地 I C 电路的选项，允许电路板上的小电压偏移，但我的是为了简化布线而连接在一起。

至于选择什么样的值终端电阻——别担心！有一个应用程序对此进行了说明！具体来说，给定(a)我们正在使用的电缆的差分阻抗和(b)差分线路的电源电压， [AN-847](http://www.ti.com/lit/an/snla031/snla031.pdf) 将带我们计算合适的总线终端电阻。

最后，为了将数据从 DI C 电缆路由出去，并返回传统的微控制器，我旋转了一个普通的 PCA9615 分线点。该板是 IMU 节点原理图中 DI C 电路的复制品，它是 DI C 链上的第一个节点，因此:它有端接电阻。

### 维护我们的电缆:

好的，多点总线在理论上看起来不错，但是我们如何将这个概念转化为一个干净的电路板网络呢？到目前为止，我最好的答案是微小的带状电缆和(可笑可爱的)带状电缆连接器和 T2 插座。带状电缆的优势在于，我们可以沿其长度在任何地方简单地压接尽可能多的中间连接器，并且每个连接器的引出线都是相同的。

![](../Images/64b2eb503da88ea9e941274d348005ff.png)

这正是我在这里所做的，这个[十针带状电缆](http://www.mouser.com/ds/2/1/ts-0875-C-247779.pdf)运行所有四个差分对(与 GND 信号交错)，其余的电线用于电源电压。至于这些连接器，就其尺寸而言，它们非常容易连接到配套电缆上。只要用老虎钳一挤，我们就连在一起了！(哈！接招，[穷凶极恶 JST SH 连接器](https://www.sparkfun.com/products/10361)！我再也不会让你成为我的副业了！)

虽然带状电缆不是双绞线，而双绞线是传输这些差分信号的理想方式，但这种带状电缆上 0.025 英寸的间距足够紧密，我称之为“足够好”

## 带迪克出去兜一圈

这就是阿迪 C 实施的总结。不太棘手，对吧？现在开始吧，愿你所有的长途 I C 项目都因一个精明的通信层和一些专业布线而大放异彩！

如果有人渴望开始使用一些示例文件，我已经在 Github 上发布了[PCB 设计文件(KiCAD)和固件。愿他们在下班后给你动力，启动你的下一个远程 DI C 项目！当然，如果你创造了什么有趣的东西，](https://github.com/Poofjunior/imu_noodle)[请给我们回信](mailto:tips@hackaday.com)。我们喜欢这样:)
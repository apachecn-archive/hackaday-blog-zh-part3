# 劫持 Sonoff OTA 机制

> 原文:[https://hack aday . com/2017/05/31/劫持-the-sonoff-ota-mechanism/](https://hackaday.com/2017/05/31/hijacking-the-sonoff-ota-mechanism/)

ITEAD 的 Sonoff 系列是一系列基于 ESP8266 的物联网设备。由于它们的可访问性，这使得它们在黑客攻击中很受欢迎。过去的项目已经找到了如何刷新 Sonoff 设备的方法，但对[mirko]来说，这还不够—[是时候对 Sonoff 空中更新协议进行逆向工程了。](http://blog.nanl.de/2017/05/sonota-flashing-itead-sonoff-devices-via-original-ota-mechanism/)

[mirko]的动机很简单——渴望不需要给公司母舰打电话的物联网设备，同时希望避免像尼安德特人一样打开每个 Sonoff 设备并重新用电线刷新它的劳动。第一步包括将 Sonoff 设备连接到 WiFi 并捕捉流量。这很快就建立了一个到远程 URL 的 SSL 连接。这很容易被拦截，因为该设备不进行任何证书验证——但遗憾的是，缺乏安全性在物联网上从来都不是一个惊喜。

在捕获网络流量后，[mirko]开始拼凑用于执行 OTA 更新的协议。在客户端和服务器之间进行基本的握手之后，服务器可以要求客户端采取各种操作，例如下载更新的固件映像。确定消息格式后，[mirko]试图用 Python 创建一个 web 服务器来复制这种行为。

有一些陷阱——固件映像需要稍微不同于通常串行上传方法的格式化，因为这一过程保持了股票引导加载程序的完整性。还有一个分割闪存存储系统要处理，这是[mirko]仍在努力。

尽管如此，看到黑客们做他们最擅长的事情——控制硬件和软件来为他们自己的目的服务，还是很棒的。要了解更多信息，为什么不看看[如何通过串行刷新您的 Sonoff 设备？](http://hackaday.com/2017/05/12/son-of-sonoff/)他们毕竟只是里面的一个 ESP8266。
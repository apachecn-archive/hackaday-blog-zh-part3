# 用 Rust 编程

> 原文：<https://hackaday.com/2015/12/18/programming-with-rust/>

硬件黑客需要新的编程语言吗？你的第一个答案可能是否定的，但是在你做出肯定的决定之前，先等等，直到你听说了一种叫做 Rust 的新语言。

我们都知道真正的黑客是用汇编语言直接给 CPU 编程的吧？好吧，我们大多数人不像以前那样做那么多汇编语言。像 C 这样的语言可以生成紧凑的、可预测的代码，并且更容易管理。

尽管有些人在一些嵌入式系统中使用更抽象的语言，但对于实时系统、设备驱动程序开发和其他类似的任务，您需要一种不会模糊底层细节或生成难以推理的代码(例如，垃圾收集)的语言，这已经不是秘密。使用特殊的技术(比如实时 Java 规范)来帮助语言是可能的，但是在一般情况下，当你必须进行裸机编程时，大多数程序员仍然会使用精益语言。

即使是非常流行的 C++，如果你使用虚函数([一个有争议的话题](http://hackaday.com/2015/11/13/code-craft-embedding-c-timing-virtual-functions/))之类的东西，它也会掩盖一些细节，尽管它是可行的。获得现代编程工具的好处是很有吸引力的，即使它确实比直接的 c 语言隐藏了更多的底层代码。

## 关于铁锈

这就是生锈的原因。我可以描述 Rust 试图实现的目标，但引用 Rust 文档的第一部分可能更容易:

> Rust 是一种专注于三个目标的系统编程语言:安全性、速度和并发性。它在没有垃圾收集器的情况下维护这些目标，使它成为许多其他语言不擅长的用例的有用语言:嵌入其他语言、具有特定空间和时间要求的程序，以及编写低级代码，如设备驱动程序和操作系统。它改进了针对这一领域的当前语言，提供了大量编译时安全检查，不会产生运行时开销，同时消除了所有数据竞争。Rust 还旨在实现“零成本抽象”,尽管其中一些抽象感觉起来像是高级语言的抽象。即便如此，Rust 仍然像低级语言一样允许精确控制。

的确，目标很高。Rust 承诺保证内存安全、没有数据竞争的线程、基于特征的泛型、类型推断、最小运行时和高效的 C 绑定(顺便说一下，编译器使用 LLVM)。您可以下载适用于 Linux、Mac 或 Windows 的软件。您甚至可以在没有安装软件的情况下，直接从主页上编辑和运行示例代码。

## 生锈的硬件

但是等等。我提到了硬件黑客语言，对吧？由于 Rust 的目标是 Linux，它可以在许多运行 Linux 的单板计算机上使用。有一个[非官方的储存库](https://github.com/warricksothr/RustBuild)处理几个基于 ARM 的主板，使得给那些电脑上锈变得容易。

如果你想看看嵌入式硬件生锈的例子，[安迪·格罗夫](不是英特尔的那个)最近发布了[一个 hello world LED 闪烁的例子，使用了 Rust 和 Beaglebone Black](http://theotherandygrove.com/blinking-an-led-with-rust-on-a-beaglebone-black/) 。他还找到了一个箱子(或多或少是一个铁锈库)来做[数字输入输出](https://crates.io/crates/sysfs_gpio)。

当然，闪烁 LED 并不十分引人注目，但它确实说明了该系统可以在嵌入式主板上工作。Rust 在编译时会做很多安全检查。它还有一个不寻常的方案，其中的变量拥有记忆。当变量超出范围时，内存被释放。显然，一次只有一个变量可以拥有一部分内存。您可以“借用”对变量的引用，但是当您这样做时，您可能会阻止将来对数据的更改(在编译时)。

## 拥有和借用内存

例如，假设您有这个([摘自 Rust 文档](https://killercup.github.io/trpl-ebook/trpl-2015-09-26.html#a-brief-introduction-to-rust)):

```

fn main() {
 let mut x = vec!["Hello", "world"];
 let y = &x[0];
}

```

变量 x 是可变的(并且是自动类型化的)。它拥有组成 vec 宏创建的向量的内存(宏调用使用感叹号)。变量 y 是对 x 的一部分的引用，它不拥有任何内存；这只是一个参考。那么这段代码将无法编译:

```

fn main() {
  let mut x = vec!["Hello", "world"];
  let y = &x[0];
  x.push("foo");
}

```

问题是更改 x(使用 push)会使对 y 的引用无效。编译器会捕捉到这一点(并且足够聪明地知道 y 变量在更改为 x 之前是否超出了范围)。您还可以将 vector 元素克隆到一个新变量中(该变量将拥有该元素的副本)。

对于特殊情况，有一些方法可以将代码标记为不安全的，并绕过通常的 Rust 检查。这只是 Rust 如何工作的一个例子——只需阅读一些代码并使用代码示例，就能感受到所有的差异。幸运的是，文档非常好。

## 其他工具和历史

Rust 还使用一个名为 Cargo 的工具来管理构建过程。除了编译之外，它还下载和构建依赖项。Rust 称编译单元为板条箱(我猜这是一个关于货物的游戏)。所以当你想到 C 语言中的库时，你会想到使用 Rust 时的箱子。

铁锈并不新鲜。Mozilla 员工 Graydon Hoare 将其作为个人项目启动。Mozilla 从 2009 年开始赞助这个项目。Rust 1.0 是首个稳定版本，于 2015 年 5 月 15 日发布。

## 我们在乎吗？

我们需要一种新的裸机语言吗？也许吧。我还没有在真实的项目中尝试过 Rust，所以不知道它是否真的会有表现。然而，我赞成在编译时发现更多问题的想法。我很喜欢的一点是 Rust 不会猜测什么对你最好。有多种类型的指针、内存单元和同步原语，允许您在不同的(有据可查的)权衡之间进行选择。正如我提到的，您甚至可以将代码标记为不安全的，并回避一些检查。

推出一门新语言很难。只有时间才能证明 Rust 是否会在 hacker 的硬盘上找到一个家。
# 电路 VR:电流镜

> 原文:[https://hackaday.com/2018/05/17/circuit-vr-current-mirrors/](https://hackaday.com/2018/05/17/circuit-vr-current-mirrors/)

上次我们看了电流吸收器的 Spice 模型。我们没有考虑简单的水槽所涉及的一些问题，对于许多实际应用来说，它们已经足够了。然而，你会经常看到更多的器件被用来改善吸电流或源电流的特性。具体而言，常见的设计是电流镜，它将电流从一个器件复制到另一个器件。通常，设置电流的器件配置非常稳定，而另一个器件处理负载电流。

例如，一些晶体管参数会根据输出电压而变化，这会导致输出中的小非线性。但是如果设置晶体管两端有固定的电压，那就不成问题了。镜像方案的唯一问题是所有涉及的晶体管都必须在关键特性上匹配。出于这个原因，镜像通常更适合晶体管大致相同的集成电路。你可以得到在单个衬底上构建多个器件的分立晶体管，但这并不常见。

请注意，关键词是“关键特征”一些参数可以不同。例如，在具有 MOSFETs 的 IC 上，使用一个晶体管来设置多个电流的情况并不少见。输出晶体管将具有不同的沟道宽度，这将放大或缩小基准电流。

## 动机

有很多地方有电流源或电流汇是很方便的。当然，我们已经研究过 LED 驱动器。电池充电和电镀通常需要——或者至少希望——恒定电流。然而，最常见的用途之一是将其用作高精度放大器的偏置元件。

当你用一个电阻偏置一个晶体管时，你实际上是在假设你知道电阻两端的电压是多少，从而设定电流。然而，在现实生活中，电路参数可能因电路而异，甚至随时间而变。偏置电阻上的电压变化会改变电流，从而改变偏置。

例如，如果你看一下典型运算放大器内部的原理图，你会发现几乎所有的放大晶体管都使用电流源和电流宿。我们将在下一期文章中讨论这个主题的细节，但是要知道这些电流源和电流汇有很多用途。

## 晶体管

[![](../Images/8fa824e4fcf821faf0027f1f66671683.png)](https://hackaday.com/wp-content/uploads/2018/05/mirror.png) 让我们来看看晶体管镜。当两个晶体管匹配时，这种反射镜工作得最好。也就是说，它们具有相同的β，并且将具有相同的 Vbe 压降。它们匹配得越好——包括它们对温度或电压变化的反应——电流镜像就越精确。

让我们从左手边开始。我们知道 Q1 的基极电压约为 0.7 V 左右，因为发射极电压为 0 V。由于 Q1 的集电极与基极相连，R1 两端的电压将是电源电压减去 0.7 V。为了简化计算，我作弊将电源电压设为 10.7 V。这意味着通过 R1 的电流——实际应用中的 Q1 集电极电流——必须是 10 V / R1。要做到这一点，基极电流必须大致等于晶体管β除以的电流。

因为晶体管完全相同，所以流经 Q1 基极的电流一定也流经 Q2 的基极。并且 Q2 集电极电流必须是基极电流乘以β，这与 Q1 的β相匹配。在相同的基极电流和贝塔系数下，流过 Q2 的电流一定与我们开始时流过 R1 的电流完全相同。

这种电路在现实生活中会出现两个问题。首先，我忽略了一些小电流，所以数字会有点偏差。只要晶体管的贝塔系数很高，误差就会很小。第二个问题是 beta。即使是同一类型的器件，晶体管的β值变化范围也很大。我们通常设计成那些变化无关紧要。在这种情况下，我们并不真的关心 beta 到底是什么，但是我们关心它们是否相同。如果他们不是，结果将是关闭的。在一个例子中，你可以在一块硅片上得到双晶体管。例如，SSM2212 有两个晶体管。它们的β值匹配在 0.5%以内。

## LTSpice

如果你尝试 LTSpice 模拟(如果你不想自己画的话，请参见 [GitHub](http://github.com/wd5gnr/circuitvr) )你会看到这些数字被证明是正确的。下面是一个运行示例:

```
--- Operating Point ---

V(n001): 10.7 voltage
V(vb): 0.7177 voltage
V(p001): 10.4845 voltage
Ic(Q2): 0.0107746 device_current
Ib(Q2): 5.06865e-005 device_current
Ie(Q2): -0.0108253 device_current
Ic(Q1): 0.00988058 device_current
Ib(Q1): 5.10312e-005 device_current
Ie(Q1): -0.00993161 device_current
I(Rload): 0.0107746 device_current
I(R1): 0.0099823 device_current
I(V1): -0.0207569 device_current
```

注意，基极电压刚刚超过 0.7 V，通过 R1 的电流刚刚低于 10 mA，通过负载的电流刚刚超过 10 mA。当然，你可以要求更高的电压。尝试将负载从 20ω改为 20kω。您还可以更改晶体管参数，以评估拥有不匹配器件的影响。

## 威尔逊

[![](../Images/967d8f4ad6c7dc15dcd92c0ed431a04e.png)](https://hackaday.com/wp-content/uploads/2018/05/wilson.png) 流经 Q1 和 Q2 的电流略有不同。这就是所谓的静态误差。这种情况下，静态误差实际上相当大，从 10.0 mA 的编程电流看，负载为 10.8 mA，四舍五入到最接近的十分之一。显然，这是一个 8%的误差:0.8 除以 10，然后乘以 100，得到一个百分比。

一般来说，如果静态误差的百分比较低，则镜子“更好”。换句话说，2 中的 1 马很可怕，但 2 中的 1 马没那么糟糕。在这种情况下，800 μA 听起来还不错，但它占总数的 8%。

事实上，有三个因素可以定义一个更好的电流镜:

1.  最小化静态误差
2.  最大化输出电阻(或者相反，最小化电导)
3.  最小化最小工作电压

有几种其他的体系结构试图解决这些问题。其中最常见的是威尔逊电流镜。正如你在原理图中看到的，它使用了三个晶体管。

在我们看它如何工作之前，让我们看看它是否真的工作。这是模拟的输出:

```
--- Operating Point ---

V(vc1):  1.74067  voltage
V(b1-2):  0.870209  voltage
V(vc3):  9.38067  voltage
V(n001):  10  voltage
Ic(Q3):  0.0412888  device_current
Ib(Q3):  0.000412888  device_current
Ie(Q3):  -0.0417016  device_current
Ic(Q2):  0.0408839  device_current
Ib(Q2):  0.000408839  device_current
Ie(Q2):  -0.0412928  device_current
Ic(Q1):  0.0408839  device_current
Ib(Q1):  0.000408839  device_current
Ie(Q1):  -0.0412928  device_current
I(R1):  0.0412966  device_current
I(Rload):  0.0412885  device_current
I(V1):  -0.0825852  device_current
```

这里，Ie(Q1)中的设定电流是 41.3 mA。通过 Rload 的输出电流也是 41.3 mA(同样，四舍五入到最接近的十分之一，即 100 微安)。如果您相信有效数字，输出会相差约 4.3 微安。现在误差在 0.01%左右。实际上，你不会达到这个数字有几个原因。首先，晶体管必须完全匹配。噪声和热梯度等各种其他因素也可能影响事物，这不会在这个简单的模拟中显示出来。尽管如此，即使它下降了 100 倍，它也将下降约 1%,这比我们以前的 8%要好得多。

## 这是怎么回事？

你不会认为增加更多器件会使电路更精确。然而，诀窍在于晶体管是匹配的。当电流进入 Q1 的集电极时，它也进入 Q3 的基极。假设有足够的电压正向偏置 Q3，它就像一个射极跟随器。基极上的电压上升导致发射极上的电压相应增加(通过二极管压降降低)。

这个电压供给了 Q1 和 Q2 的基地。净效应是一切都在上升，直到 Q1 的集电极电流加上 Q3 的基极电流与输入电流完全匹配。此时，请记住，所有的β值都应该相等，基极电流几乎相等，从而获得仿真中看到的最佳匹配。如果某个参数受到干扰，只要晶体管保持匹配，系统就会自我修正。

如果你尝试改变 R1 和输入电压，你会看到所有的项目是如何变化的，以保持同步。

所以威尔逊镜更好，对吧？嗯，和任何事情一样，没有免费的午餐。是的，静态误差下降。但是元件数量会增加，并且会产生额外的噪声和频率相关效应。此外，威尔逊镜比等效电路需要更多的电压。

还有其他具有不同折衷的架构，包括具有四个晶体管而不是三个晶体管的威尔逊电路。其他像 Widlar 和 cascode 这样的电路有不同的优缺点。

模拟电路设计有点像象棋。你可以很容易地了解棋子是如何移动的。但是掌握策略需要一生的时间。电流镜只是晶体管魔术帽中的又一个把戏。真正的诀窍是应用它们，并将它们与其他元素结合起来，以获得想要的行为。